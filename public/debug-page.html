<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ç³»çµ±ç‰ˆæœ¬æª¢æŸ¥é é¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .success { color: green; } .error { color: red; } .warning { color: orange; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” é¤å»³è©•åƒ¹ç³»çµ± - ç‰ˆæœ¬æª¢æŸ¥é é¢</h1>
        
        <div id="status">æª¢æŸ¥ä¸­...</div>
        
        <h3>ğŸ“Š ç³»çµ±ç‹€æ…‹</h3>
        <div id="systemInfo"></div>
        
        <h3>ğŸ§  åŠŸèƒ½æª¢æŸ¥</h3>
        <div id="featureCheck"></div>
        
        <h3>ğŸ”§ å¿«é€Ÿä¿®å¾©</h3>
        <button onclick="clearCacheAndReload()">ğŸ”„ æ¸…é™¤ç·©å­˜ä¸¦åˆ·æ–°</button>
        <button onclick="forceReload()">âš¡ å¼·åˆ¶é‡æ–°è¼‰å…¥</button>
        <button onclick="checkAPI()">ğŸ“¡ æ¸¬è©¦API</button>
        <button onclick="goToMain()">ğŸ  è¿”å›ä¸»é </button>
        
        <div id="apiResult"></div>
        
        <h3>ğŸ“± å¦‚æœä»çœ‹åˆ°èˆŠç‰ˆæœ¬</h3>
        <ol>
            <li>æŒ‰ <strong>Ctrl+Shift+Delete</strong> (Chrome) æˆ– <strong>Ctrl+Shift+R</strong> (Firefox)</li>
            <li>æ¸…é™¤ "ç·©å­˜åœ–åƒå’Œæ–‡ä»¶"</li>
            <li>é‡æ–°è¼‰å…¥æ­¤é é¢</li>
            <li>å¦‚æœä»æœ‰å•é¡Œï¼Œè«‹å˜—è©¦ç„¡ç—•æ¨¡å¼</li>
        </ol>
    </div>

    <script>
        // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
        function checkSystemStatus() {
            const now = new Date();
            document.getElementById('status').innerHTML = `
                <div class="success">âœ… æª¢æŸ¥é é¢å·²è¼‰å…¥</div>
                <div>ğŸ• ç•¶å‰æ™‚é–“: ${now.toLocaleString('zh-TW')}</div>
                <div>ğŸŒ ç•¶å‰URL: ${window.location.href}</div>
            `;
            
            // æª¢æŸ¥ç³»çµ±ä¿¡æ¯
            document.getElementById('systemInfo').innerHTML = `
                <div>ğŸ“± ç”¨æˆ¶ä»£ç†: ${navigator.userAgent.substring(0, 100)}...</div>
                <div>ğŸ”§ ç€è¦½å™¨: ${navigator.appName} ${navigator.appVersion.substring(0, 50)}...</div>
            `;
            
            // æª¢æŸ¥åŠŸèƒ½
            checkFeatures();
        }
        
        function checkFeatures() {
            const features = {
                'è¨˜æ†¶å ±å‘Š': document.body.innerHTML.includes('è¨˜æ†¶å ±å‘Š'),
                'ratingChangeIndicator': document.body.innerHTML.includes('ratingChangeIndicator'), 
                'æŸ¥çœ‹è©³æƒ…': document.body.innerHTML.includes('æŸ¥çœ‹è©³æƒ…'),
                'è‡ªå‹•é€šçŸ¥è¨­å®š': document.body.innerHTML.includes('è‡ªå‹•é€šçŸ¥è¨­å®š')
            };
            
            let html = '';
            for (const [feature, exists] of Object.entries(features)) {
                html += `<div class="${exists ? 'success' : 'error'}">
                    ${exists ? 'âœ…' : 'âŒ'} ${feature}: ${exists ? 'å·²æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}
                </div>`;
            }
            
            document.getElementById('featureCheck').innerHTML = html;
        }
        
        async function checkAPI() {
            document.getElementById('apiResult').innerHTML = '<div>ğŸ“¡ æ¸¬è©¦APIä¸­...</div>';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        stores: [{
                            id: 1,
                            name: 'æ¸¬è©¦åˆ†åº—',
                            urls: {
                                google: 'https://maps.app.goo.gl/fS8RAzxJpBjVpSQT9',
                                uber: 'https://www.ubereats.com/store-browse-uuid/dcbd639d-d703-5c60-a55e-7ddb1a6954f9',
                                panda: 'https://foodpanda.page.link/yhvLQKDDAScTN5rq7'
                            }
                        }]
                    })
                });
                
                const data = await response.json();
                
                let html = `<div class="success">âœ… APIæ¸¬è©¦æˆåŠŸ</div>`;
                html += `<div>ğŸ“Š å¹³å‡è©•åˆ†: ${data.summary?.averageRating}</div>`;
                html += `<div>ğŸ§  è¨˜æ†¶åŠŸèƒ½: ${data.memory ? 'âœ… å·²å•Ÿç”¨' : 'âŒ æœªå•Ÿç”¨'}</div>`;
                html += `<div class="code">APIå›æ‡‰: ${JSON.stringify(data, null, 2).substring(0, 500)}...</div>`;
                
                document.getElementById('apiResult').innerHTML = html;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = `
                    <div class="error">âŒ APIæ¸¬è©¦å¤±æ•—: ${error.message}</div>
                `;
            }
        }
        
        function clearCacheAndReload() {
            // æ¸…é™¤localStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // æ·»åŠ æ™‚é–“æˆ³å¼·åˆ¶åˆ·æ–°
            const url = new URL(window.location);
            url.searchParams.set('v', Date.now());
            window.location.href = url.toString();
        }
        
        function forceReload() {
            window.location.reload(true);
        }
        
        function goToMain() {
            window.location.href = '/';
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œæª¢æŸ¥
        window.onload = checkSystemStatus;
    </script>
</body>
</html>
# 🔬 智能分店評價查詢系統 - 使用指南

## 系統概述

本系統提供**真實可靠**的分店評價數據查詢功能，自動檢測並警告假數據問題。

### ⚠️ 重要發現

**Railway API 目前返回假數據（Fallback Data）**，本系統已實現：
- 自動檢測假數據
- 明確標記假數據來源
- 提供本地真實爬蟲替代方案

## 🎯 核心功能

### ✅ 已實現功能
1. **智能假數據檢測** - 自動識別並警告假數據
2. **分開執行架構** - 三家分店獨立查詢，提高穩定性
3. **測試模式** - 僅發送管理員群組，避免打擾用戶
4. **多平台支持** - Google Maps、UberEats、Foodpanda
5. **本地爬蟲系統** - 真實數據爬取（備用方案）
6. **智能通知系統** - Telegram自動通知

### 📁 系統文件結構

```
D:\分店評價\
├── smart-scheduler.js           # 主要系統（推薦使用）
├── local-crawler-system.js     # 本地爬蟲系統
├── cloud_automation_scheduler.js # 原版系統（已修改）
├── enhanced-scheduler.js        # 增強版（有語法問題）
├── public/
│   └── index.html              # Web界面
├── logs/                       # 執行日誌
├── query_results/             # 查詢結果
└── crawler_results/           # 爬蟲結果
```

## 🚀 使用方法

### 1. 推薦方案：智能查詢系統

```bash
cd "D:\分店評價"
node smart-scheduler.js
```

**功能特色：**
- ✅ 自動檢測假數據
- ✅ 分店分開查詢
- ✅ 測試模式（僅管理員通知）
- ✅ 完整錯誤處理
- ✅ 詳細執行報告

### 2. 備用方案：本地真實爬蟲

```bash
cd "D:\分店評價"
node local-crawler-system.js
```

**功能特色：**
- ✅ 真實數據保證
- ✅ 使用Puppeteer爬蟲
- ⚠️ 執行時間較長
- ⚠️ 需要穩定網路環境

### 3. 原版系統（已修改）

```bash
cd "D:\分店評價"
node cloud_automation_scheduler.js
```

**功能特色：**
- ✅ 分店分開查詢
- ✅ 測試模式
- ⚠️ 仍依賴Railway API假數據

## 📊 系統輸出範例

### 正常執行輸出
```
════════════════════════════════════════
   🔬 智能分店評價查詢系統 v1.0
   自動檢測假數據・分開執行・穩定可靠
════════════════════════════════════════

[2025/9/1 下午4:42:18] 🔬 啟動智能分店評價查詢系統
[2025/9/1 下午4:42:19] 📍 正在查詢 1/3: 不早脆皮雞排 中壢龍崗店
[2025/9/1 下午4:42:20] ⚠️ 不早脆皮雞排 中壢龍崗店 返回假數據
[2025/9/1 下午4:42:20] ⏳ 等待2秒後查詢下一個分店...
...
[2025/9/1 下午4:42:29] ✅ Telegram通知發送成功
[2025/9/1 下午4:42:29] ✅ 執行完成，總耗時: 10 秒
```

### Telegram報告範例
```
🔬 智能查詢系統報告
━━━━━━━━━━━━━━━━━━━━━━
⏰ 執行時間: 2025/9/1 下午4:42:27
🏪 查詢分店: 3 家

⚠️ 重要警告: 檢測到假數據
本次查詢包含Railway API預設的假數據
這些數據不是真實的爬蟲結果

📊 各分店詳情:

【1】不早脆皮雞排 中壢龍崗店
⭐ 平均評分: 4.7/5.0
  📱 Google Maps: 4.6⭐ (1,183 評論) ⚠️[假數據]
  📱 UberEats: 4.8⭐ (600+ 評論) ⚠️[假數據]
  📱 Foodpanda: 4.7⭐ (500+ 評論) ⚠️[假數據]

📈 整體平均評分: 4.6⭐
✅ 成功查詢: 3/3 個分店

🔧 建議解決方案:
• 檢查Railway服務器端爬蟲功能
• 考慮使用本地爬蟲系統
• 聯繫技術團隊修復數據來源

🤖 智能查詢系統 v1.0 - 已檢測假數據問題
```

## ⚙️ 配置設定

### Telegram通知配置

在各系統文件中修改：

```javascript
// 測試階段配置（推薦）
const config = {
    telegramBotToken: '7659930552:AAF_jF1rAXFnjFO176-9X5fKfBwbrko8BNc',
    adminGroup: '-1002658082392',  // 僅管理員群組
    // testMode: true // 測試模式開啟
};

// 生產環境配置（測試穩定後使用）
const config = {
    telegramGroups: {
        admin: '-1002658082392',    // 管理員群組
        boss: '-4739541077',       // 老闆群組  
        employee: '-4757083844'    // 員工群組
    },
    // testMode: false // 測試模式關閉
};
```

### 分店資料配置

```javascript
const stores = [
    {
        name: '不早脆皮雞排 中壢龍崗店',
        urls: {
            google: 'https://www.google.com/maps/...',
            uber: 'https://www.ubereats.com/store/...',
            panda: 'https://www.foodpanda.com.tw/restaurant/...'
        }
    }
    // 更多分店...
];
```

## 🔧 問題解決

### Railway API 假數據問題

**問題：** Railway API返回 `"source": "Fallback Data"`，非真實爬蟲數據

**解決方案：**
1. **立即方案：** 使用智能查詢系統，自動檢測並警告
2. **中期方案：** 使用本地爬蟲系統獲取真實數據
3. **長期方案：** 修復Railway服務器端爬蟲功能

### 網路連接問題

**問題：** API請求超時或失敗

**解決方案：**
```javascript
// 調整超時設定
const config = {
    timeout: 60000,  // 增加到60秒
    maxRetries: 5    // 增加重試次數
};
```

### 本地爬蟲問題

**問題：** Puppeteer啟動失敗或爬取失敗

**解決方案：**
```bash
# 確保Puppeteer已安裝
npm install puppeteer --save

# 檢查系統依賴
npm audit fix
```

## 📅 定時執行設定

### Windows 工作排程器

1. 開啟「工作排程器」
2. 建立基本工作
3. 設定觸發條件（例：每天下午5點）
4. 動作：啟動程式
   - 程式：`node`
   - 引數：`D:\分店評價\smart-scheduler.js`
   - 開始於：`D:\分店評價`

### Linux/Mac crontab

```bash
# 編輯crontab
crontab -e

# 添加每日17:00執行
0 17 * * * cd /path/to/分店評價 && node smart-scheduler.js
```

## 📈 監控與維護

### 查看執行日誌

```bash
# 查看最新結果
ls -la D:\分店評價\query_results\

# 查看執行日誌
ls -la D:\分店評價\logs\
```

### 監控假數據狀態

系統會在Telegram報告中明確標示假數據：
- ⚠️[假數據] - 標記假數據項目
- 提供解決建議
- 記錄到執行日誌

## 🎯 最佳實踐

### 1. 測試階段（當前）
- 使用 `smart-scheduler.js`
- 開啟測試模式（僅管理員通知）
- 監控假數據警告
- 記錄執行穩定性

### 2. 穩定後部署
- 確認系統穩定運行7天
- 關閉測試模式
- 啟用所有群組通知
- 設定自動定時執行

### 3. 數據品質監控
- 定期檢查假數據警告
- 比較不同時間的數據變化
- 監控系統執行成功率

## 🔮 未來改進計劃

### 短期（1-2週）
- [ ] 修復Railway服務器端爬蟲功能
- [ ] 完善本地爬蟲的網頁元素選擇器
- [ ] 增加更多錯誤處理和重試邏輯

### 中期（1個月）
- [ ] 實現真實數據與歷史數據比較
- [ ] 增加數據可視化圖表
- [ ] 建立數據品質評分系統

### 長期（3個月）
- [ ] 支援更多評價平台
- [ ] 實現機器學習數據預測
- [ ] 建立完整的數據分析儀表板

## 📞 技術支援

### 聯繫資訊
- **系統維護：** 技術團隊
- **Telegram群組：** 管理員群組 (-1002658082392)
- **緊急問題：** 查看系統執行日誌

### 常見問題快速解決
1. **系統無回應：** 檢查網路連接和Railway API狀態
2. **假數據警告：** 正常現象，系統已自動檢測並標記
3. **Telegram未收到通知：** 檢查Bot Token和群組ID設定
4. **執行錯誤：** 查看最新執行日誌文件

---

## 📋 更新記錄

### v1.0 (2025-09-01)
- ✅ 實現智能假數據檢測
- ✅ 分店分開查詢架構
- ✅ 測試模式通知系統
- ✅ 本地爬蟲備用系統
- ✅ 完整錯誤處理機制

---

**🤖 智能分店評價查詢系統 v1.0**  
*自動檢測假數據・分開執行・穩定可靠*